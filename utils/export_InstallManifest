#!/usr/bin/bash
#This file is intended to be automatically configurated by CMake.


#This script is meant to be used after the install process has been completed. By default it is called by the
#Make install target after installation.
#This script exports the install_manifest.txt file, automaticly generated by Cmake after the installation process.
#The destination can be sent by argument. If no arg is set, it will export it automatically on DefaultPath

#This variable will be set by CMake
ProjectName=@PROJECT_NAME@

#Default path if no arg is set
DefaultPath="/usr/local/diana/sys/manifests/${ProjectName}"


#Path of this script
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"

# Check if there are any arguments
if [ $# -eq 0 ]; then

  #Destination variable
  DESTINATION=${DefaultPath}/${ProjectName}/install_manifest.txt

  #Create destination if not existing
  sudo mkdir -p "${DefaultPath}/${ProjectName}" #2>/dev/null

  #Copy file
  sudo cp "${SCRIPT_DIR}/install_manifest.txt" "${DESTINATION}"
  if [ $? -eq 0 ]; then
    # Print a success message
    echo -e "\033[32m${SCRIPT_DIR}/$0: succesfully exported install manifest as ${DESTINATION}\033[0m"
    exit 0
  else
    # Print a failure message
    echo -e "\033[31m${SCRIPT_DIR}/$0: Error: could export install manifest as ${DESTINATION}\033[0m"
    exit 1
  fi

else
   #Destination variable
  DESTINATION=${1}/${ProjectName}/install_manifest.txt

  #create destination folder
    sudo mkdir -p "${1}/${ProjectName}" #2>/dev/null
  #copy file
    sudo cp "${SCRIPT_DIR}/install_manifest.txt" "${DESTINATION}"
    if [ $? -eq 0 ]; then
      # Print a success message
      echo -e "\033[32m${SCRIPT_DIR}/$0: succesfully exported install manifest as ${DESTINATION}\033[0m"
      exit 0
    else
      # Print a failure message
      echo -e "\033[31m${SCRIPT_DIR}/$0: Error: could not export install manifest as ${DESTINATION}\033[0m"
      exit 1
    fi
fi

echo "How tf did you reach this part of code??"
exit 100
